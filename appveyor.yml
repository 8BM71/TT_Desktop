version: 0.0.0.{build}
image: Visual Studio 2015


environment:
  QTDIR: C:\Qt\5.9.2\msvc2015
  VSPATH: C:\Program Files (x86)\Microsoft Visual Studio 14.0\VC
  TOOLSDIR: C:\Qt\Tools\QtCreator
  INSTALLER_NAME: "%APPVEYOR_PROJECT_NAME%%APPVEYOR_BUILD_VERSION%"

before_build:
  - set PATH=%PATH%;%QTDIR%\bin;%VSPATH%\bin;%TOOLSDIR%\bin
  - call "%VSPATH%\vcvarsall.bat"
  - mkdir build

build_script:
  - cd build
  - qmake ../tputt.pro -spec win32-msvc
  - jom

after_build:
  - windeployqt --release %APPVEYOR_BUILD_FOLDER%\bin\release --qmldir %APPVEYOR_BUILD_FOLDER%
  - xcopy C:\OpenSSL-Win32\bin\libeay32.dll %APPVEYOR_BUILD_FOLDER%\bin\release /y
  - xcopy C:\OpenSSL-Win32\bin\ssleay32.dll %APPVEYOR_BUILD_FOLDER%\bin\release /y
  - iscc "%APPVEYOR_BUILD_FOLDER%\.appveyor\installer.iss"
  - 7z a -y ..\bin\installs\tttpu.zip %APPVEYOR_BUILD_FOLDER%\bin\release\*

artifacts:
  - path: bin/installs/tttpu.zip
    name: tttpu
    type: zip
  - path: bin/installs/%INSTALLER_NAME%.exe
    name: tttpu
    type: exe